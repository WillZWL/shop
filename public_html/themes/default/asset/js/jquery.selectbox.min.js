!function(a,b){function f(){this._state=[],this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}var c="selectbox",d=!1,e=!0;a.extend(f.prototype,{_isOpenSelectbox:function(a){if(!a)return d;var b=this._getInst(a);return b.isOpen},_isDisabledSelectbox:function(a){if(!a)return d;var b=this._getInst(a);return b.isDisabled},_attachSelectbox:function(b,f){function r(){var b,c=this.attr("id").split("_")[1];for(b in h._state)b!==c&&h._state.hasOwnProperty(b)&&a(":input[sb='"+b+"']")[0]&&h._closeSelectbox(a(":input[sb='"+b+"']")[0])}function s(){var c=arguments[1]&&arguments[1].sub?!0:!1,d=arguments[1]&&arguments[1].disabled?!0:!1;arguments[0].each(function(f){var o,g=a(this),j=a("<li>");g.is(":selected")&&(k.text(g.text()),n=e),f===q-1&&j.addClass("last"),g.is(":disabled")||d?(o=a("<span>",{text:g.text()}).addClass(i.settings.classDisabled),c&&o.addClass(i.settings.classSub),o.appendTo(j)):(o=a("<a>",{href:"#"+g.val(),rel:g.val(),text:g.text(),click:function(c){c.preventDefault();var d=l;d.attr("id").split("_")[1];h._changeSelectbox(b,a(this).attr("rel"),a(this).text()),h._closeSelectbox(b)}}),c&&o.addClass(i.settings.classSub),o.appendTo(j)),j.appendTo(m)})}if(this._getInst(b))return d;var j,k,l,m,g=a(b),h=this,i=h._newInst(g),n=d,p=(g.find("optgroup"),g.find("option")),q=p.length;g.attr("sb",i.id),a.extend(i.settings,h._defaults,f),h._state[i.id]=d,g.hide(),j=a("<div>",{id:"sbHolder_"+i.id,"class":i.settings.classHolder}),k=a("<a>",{id:"sbSelector_"+i.id,href:"#","class":i.settings.classSelector,click:function(c){c.preventDefault(),r.apply(a(this),[]);var d=a(this).attr("id").split("_")[1];h._state[d]?h._closeSelectbox(b):h._openSelectbox(b)}}),l=a("<a>",{id:"sbToggle_"+i.id,href:"#","class":i.settings.classToggle,click:function(c){c.preventDefault(),r.apply(a(this),[]);var d=a(this).attr("id").split("_")[1];h._state[d]?h._closeSelectbox(b):h._openSelectbox(b)}}),l.appendTo(j),m=a("<ul>",{id:"sbOptions_"+i.id,"class":i.settings.classOptions,css:{display:"none"}}),g.children().each(function(b){var d,c=a(this),e={};c.is("option")?s(c):c.is("optgroup")&&(d=a("<li>"),a("<span>",{text:c.attr("label")}).addClass(i.settings.classGroup).appendTo(d),d.appendTo(m),c.is(":disabled")&&(e.disabled=!0),e.sub=!0,s(c.find("option"),e))}),n||k.text(p.first().text()),a.data(b,c,i),k.appendTo(j),m.appendTo(j),j.insertAfter(g)},_detachSelectbox:function(b){var e=this._getInst(b);return e?(a("#sbHolder_"+e.id).remove(),a.data(b,c,null),void a(b).show()):d},_changeSelectbox:function(b,c,d){var f=this._getInst(b),g=this._get(f,"onChange");a("#sbSelector_"+f.id).text(d),a(b).find("option[value='"+c+"']").attr("selected",e),g?g.apply(f.input?f.input[0]:null,[c,f]):f.input&&f.input.trigger("change")},_enableSelectbox:function(b){var e=this._getInst(b);return e&&e.isDisabled?(a("#sbHolder_"+e.id).removeClass(e.settings.classHolderDisabled),e.isDisabled=d,void a.data(b,c,e)):d},_disableSelectbox:function(b){var f=this._getInst(b);return!f||f.isDisabled?d:(a("#sbHolder_"+f.id).addClass(f.settings.classHolderDisabled),f.isDisabled=e,void a.data(b,c,f))},_optionSelectbox:function(b,e,f){var g=this._getInst(b);return g?(g[e]=f,void a.data(b,c,g)):d},_openSelectbox:function(b){var d=this._getInst(b);if(d&&!d.isOpen&&!d.isDisabled){var f=a("#sbOptions_"+d.id),g=parseInt(a(window).height(),10),h=a("#sbHolder_"+d.id).offset(),i=a(window).scrollTop(),j=f.prev().height(),k=g-(h.top-i)-j/2,l=this._get(d,"onOpen");f.css({top:j+"px",maxHeight:k-j+"px"}),"fade"===d.settings.effect?f.fadeIn(d.settings.speed):f.slideDown(d.settings.speed),a("#sbToggle_"+d.id).addClass(d.settings.classToggleOpen),this._state[d.id]=e,d.isOpen=e,l&&l.apply(d.input?d.input[0]:null,[d]),a.data(b,c,d)}},_closeSelectbox:function(b){var e=this._getInst(b);if(e&&e.isOpen){var f=this._get(e,"onClose");"fade"===e.settings.effect?a("#sbOptions_"+e.id).fadeOut(e.settings.speed):a("#sbOptions_"+e.id).slideUp(e.settings.speed),a("#sbToggle_"+e.id).removeClass(e.settings.classToggleOpen),this._state[e.id]=d,e.isOpen=d,f&&f.apply(e.input?e.input[0]:null,[e]),a.data(b,c,e)}},_newInst:function(a){var b=a[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:b,input:a,uid:Math.floor(99999999*Math.random()),isOpen:d,isDisabled:d,settings:{}}},_getInst:function(b){try{return a.data(b,c)}catch(d){throw"Missing instance data for this selectbox"}},_get:function(a,c){return a.settings[c]!==b?a.settings[c]:this._defaults[c]}}),a.fn.selectbox=function(b){var c=Array.prototype.slice.call(arguments,1);return"string"==typeof b&&"isDisabled"==b?a.selectbox["_"+b+"Selectbox"].apply(a.selectbox,[this[0]].concat(c)):"option"==b&&2==arguments.length&&"string"==typeof arguments[1]?a.selectbox["_"+b+"Selectbox"].apply(a.selectbox,[this[0]].concat(c)):this.each(function(){"string"==typeof b?a.selectbox["_"+b+"Selectbox"].apply(a.selectbox,[this].concat(c)):a.selectbox._attachSelectbox(this,b)})},a.selectbox=new f,a.selectbox.version="0.1.3"}(jQuery);